{% extends "base.html" %}
{% block main %}
<div class="container mt-4 page-column page-curl">

  <div class="py-4">
    <form id="inline-search-form" onsubmit="event.preventDefault(); doInlineSearch();" class="d-flex">
      <input id="search-inline" name="q" type="text" class="form-control rounded-pill me-2" placeholder="Search another word">
      <button type="button" onclick="doInlineSearch()" class="btn btn-primary btn-lg rounded-pill">
        Search</button>

    </form>

    <script>
      function doInlineSearch() {
          const term = document.getElementById("search-inline").value.trim();
          if (term) {
              window.location.href = "/word/" + encodeURIComponent(term);
          }
      }
    </script>
  </div>

  <div id="results-start" class="mt-3"></div>

  <div class="d-flex align-items-center justify-content-between my-4">
    <div>
      <h2 class="display-5 mb-0">{{ term }}</h2>
      {% if phonetic %}<div class="text-muted">{{ phonetic }}</div>{% endif %}
    </div>
  </div>

  <!--Definitions(dictionaryapi.dev)-->
  <div class="card mb-3 shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Definition (dictionaryapi.dev)</h5>
      {% if definitions %}
        <ul class="list-unstyled">
          {% for d in definitions %}
            <li class="mb-2">
              <div class="small text-muted">{{ d.partOfSpeech }}</div>
              <div>{{ d.definition }}</div>
              {% if d.example %}<div class="text-muted">“{{ d.example }}”</div>{% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="text-muted">No definitions found from dictionaryapi.dev</div>
      {% endif %}
    </div>
  </div>

  <!--Wikipedia summary-->
  <div class="card mb-3 shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Encyclopedia (Wikipedia)</h5>
      {% if wikipedia.extract %}
        <p>{{ wikipedia.extract }}</p>
        {% if wikipedia.url %}
          <a href="{{ wikipedia.url }}" target="_blank">Read the full article on Wikipedia</a>
        {% endif %}
      {% else %}
        <div class="text-muted">No Wikipedia summary found.</div>
      {% endif %}
    </div>
  </div>

  <!--Etymology-->
  <div class="card mb-3 shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Etymology</h5>
      {% if etymology %}
        <p>{{ etymology }}</p>
      {% else %}
        <div class="text-muted">No etymology found on Wiktionary (or parsing failed).</div>
      {% endif %}
    </div>
  </div>

  <!--Usage chart placeholder-->
  <div class="card mb-3 shadow-sm">
    <div class="card-body">
      <h5 class="card-title">Usage Over Time (Google Books Ngram)</h5>
      <div id="ngram-chart" style="height:300px;">
        {% if ngram and ngram|length %}
          <canvas id="ngramCanvas"></canvas>
        {% else %}
          <div class="text-muted">Ngram data not available.</div>
        {% endif %}
      </div>
    </div>
  </div>

  <!--footer stays below and will move down naturally-->
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script id="ngram-data" type="application/json">
  {{ ngram | tojson | safe }}
</script>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // Parse JSON
  const ngramScript = document.getElementById("ngram-data");
  let ngramData = [];
  try {
    ngramData = JSON.parse(ngramScript.textContent);
  } catch (e) {
    console.warn("Invalid or missing ngram data");
  }

  if (Array.isArray(ngramData) && ngramData.length > 0) {
    const years = ngramData.map(p => p.year);
    const freqs = ngramData.map(p => p.freq);

    const ctx = document.getElementById("ngramCanvas").getContext("2d");
    new Chart(ctx, {
      type: "line",
      data: {
        labels: years,
        datasets: [{
          label: "Usage Frequency",
          data: freqs,
          borderWidth: 2,
          borderColor: "#3046d9",
          tension: 0.2
        }]
      },
      options: {
        scales: {
          y: { beginAtZero: false }
        },
        plugins: { legend: { display: false } }
      }
    });
  }
});
</script>
{% endblock %}

